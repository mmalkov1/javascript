"use strict";window.onload=function(){var e=[].concat(JSON.parse(localStorage.getItem("bookmarks")));function t(t){var o=document.querySelector("#entry-template").innerHTML.trim(),r=Handlebars.compile(o),n=t.reduce(function(e,t){return e+r(t)},"");document.querySelector(".table").innerHTML=n,localStorage.setItem("bookmarks",JSON.stringify(e))}null==localStorage.getItem("bookmarks")&&(e=[]),console.log(e),"[null]"!=localStorage.getItem("bookmarks")&&t(e),document.querySelector("#add_btn").addEventListener("click",function(){var o,r=document.querySelector("#link").value;if(-1!=r.search(/([\w\.]+)\.([a-z]{2,6}\.?)(\/[\w\.]*)*\/?$/))o=r,document.querySelector(".message").classList.add("show"),fetch("https://api.linkpreview.net/?key=5b65625db87a5f5e988012e8de1972afaae235744bd1d&q=https://"+o).then(function(e){if(console.log(e.status),200===e.status)return e.json();alert("Такого URL-адреса не существует"),document.querySelector(".message").classList.remove("show"),console.log("Неверный запрос!")}).then(function(o){null==e.find(function(e){return e.url==o.url})?(o.title=o.title.substr(0,50)+"...",o.description=o.description.substr(0,60)+"...",e.unshift(o),document.querySelector(".message").classList.remove("show"),t(e),localStorage.setItem("bookmarks",JSON.stringify(e))):(alert("Данный ресурс уже добавлен в закладки!"),document.querySelector(".message").classList.remove("show"))}).catch(function(e){return console.log(e)});else alert("Введите корректный адрес сайта!")}),document.querySelector("#table").addEventListener("click",function(o){var r=document.querySelectorAll(".remove");if(Array.from(r).includes(o.target)){o.preventDefault();var n=o.target.dataset.link,l=e.indexOf(e.find(function(e){return e.url==n}));e.splice(l,1),t(e)}})};